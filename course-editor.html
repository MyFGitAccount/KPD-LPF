<script type="module">
import API from './api.js';

let coursesDatabase = {};

async function loadCoursesDatabase() {
  const res = await API.getCourses();
  coursesDatabase = res.data || {};
  console.log('Courses loaded (editor):', Object.keys(coursesDatabase));

  const urlParams = new URLSearchParams(location.search);
  const courseCode = urlParams.get('code');
  if (courseCode && coursesDatabase[courseCode]) {
    document.getElementById('course_code').value = courseCode;
    document.getElementById('course_code').readOnly = true;
    document.getElementById('course_title').value = coursesDatabase[courseCode];
    document.getElementById('editorSubtitle').textContent = `Edit: ${courseCode}`;
  }
}
loadCoursesDatabase();

document.getElementById('editorForm').addEventListener('submit', async e => {
  e.preventDefault();
  const code = document.getElementById('course_code').value.toUpperCase().trim();
  const title = document.getElementById('course_title').value.trim();
  if (!code || !title) return alert('Fill both fields');
  const res = await API.requestCourse({ code, title });
  if (!res.ok) return alert(res.error || 'Failed');
  alert(`Request for ${code} submitted.`);
  location.href = 'Mainpage.html';
});

function cancelEdit() {
  if (confirm('Discard changes?')) location.href = 'Mainpage.html';
}
</script>
