<script type="module">
import API from './api.js';

const urlParams = new URLSearchParams(location.search);
const courseCode = urlParams.get('code');

async function loadCourses() {
  const courses = await API.getCourses().then(r => r.data);
  if (courseCode && courses[courseCode]) {
    document.getElementById('course_code').value = courseCode;
    document.getElementById('course_code').readOnly = true;
    document.getElementById('course_title').value = courses[courseCode];
    document.getElementById('editorSubtitle').textContent = `Edit: ${courseCode}`;
  }
}
loadCourses();

document.getElementById('editorForm').addEventListener('submit', async e => {
  e.preventDefault();
  const code = document.getElementById('course_code').value.toUpperCase().trim();
  const title = document.getElementById('course_title').value.trim();
  if (!code || !title) return alert('Fill both fields');
  const res = await API.requestCourse({ code, title });
  if (!res.ok) return alert(res.error || 'Failed');
  alert(`Course request for ${code} submitted.`);
  location.href = 'Mainpage.html';
});

function cancelEdit(){ if(confirm('Discard changes?')) location.href='Mainpage.html'; }
</script>
