<script type="module">
import API from './api.js';

const photoInput = document.getElementById('photo');
const preview = document.getElementById('preview');
const previewImg = document.getElementById('previewImg');

photoInput.addEventListener('change', () => {
  const file = photoInput.files?.[0];
  if (!file) { preview.style.display = 'none'; return; }
  const reader = new FileReader();
  reader.onload = e => { previewImg.src = e.target.result; preview.style.display = 'flex'; };
  reader.readAsDataURL(file);
});

document.getElementById('createForm').addEventListener('submit', async e => {
  e.preventDefault();
  const sid = document.getElementById('sid').value.trim();
  const pwd = document.getElementById('pwd').value;
  const file = photoInput.files?.[0];
  if (!sid || !pwd || !file) return;

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.querySelector('.btn-text').textContent = 'Waiting';

  // ---- read photo as Base64 ----
  const reader = new FileReader();
  reader.onload = async ev => {
    const photoBase64 = ev.target.result;
    const res = await API.createAccount({ sid, password: pwd, photoBase64 });
    if (!res.ok) {
      alert(res.error || 'Failed');
      btn.disabled = false;
      btn.querySelector('.btn-text').textContent = 'Submit';
      return;
    }
    alert('Account request submitted! Admin must approve.');
    // stay on page â€“ data already in localStorage
  };
  reader.readAsDataURL(file);
});
</script>
